# ðŸŽ¨ GENERATOR NODE'LARINI MEVCUT WORKFLOW'A EKLEME TALÄ°MATI

## 1. MEVCUT WORKFLOW'U AÃ‡
n8n'de `ðŸŒ™ Submirra - Unified` workflow'unu aÃ§.

## 2. YENÄ° WEBHOOK NODE EKLE

**Node:** Webhook
- **Name:** ðŸŽ¨ Generator Webhook
- **Path:** generator-webhook  
- **Method:** POST
- **Position:** Dream Webhook'un ÃœSTÃœNE koy (Ã¶r: position [-16, -600])

## 3. GENERATOR NODE'LARINI EKLE (SIRASIYLA)

### Node 1: Set Generator Variables (Set node)
```
Name: Set Generator Variables
Assignments:
  - user_id = {{ $json.body.user_id }}
  - source_image_url = {{ $json.body.source_image_url }}
  - prompt = {{ $json.body.prompt }}
  - generation_id = {{ $json.body.generation_id }}
Position: [224, -600]
```

### Node 2: Check Premium (Generator) (Supabase node)
```
Name: Check Premium (Generator)
Operation: GET
Table: subscriptions
Filter: user_id = {{ $json.user_id }}
Position: [448, -600]
```

### Node 3: Is Premium? (IF node)
```
Name: Is Premium?
Condition: {{ $json.plan_type }} EQUALS "premium"
Position: [672, -600]
```

### Node 4A (TRUE branch): Enhance Prompt (AI Agent)
```
Name: Enhance Prompt
Type: AI Agent (Langchain)
Model: OpenAI GPT-4o-mini
Prompt: 
"You are an expert image transformation prompt engineer. 
Transform the user's request into a detailed Leonardo AI prompt.

USER REQUEST:
{{ $('Set Generator Variables').item.json.prompt }}

Create a detailed prompt (max 500 chars) for image-to-image transformation. 
Output ONLY the prompt."

Position: [896, -700]
```

### Node 5: Set Enhanced (Set node)
```
Name: Set Enhanced
Assignments:
  - enhanced_prompt = {{ $json.output.replace(/"/g, '').trim().substring(0, 500) }}
  - user_id = {{ $('Set Generator Variables').item.json.user_id }}
  - source_image_url = {{ $('Set Generator Variables').item.json.source_image_url }}
  - generation_id = {{ $('Set Generator Variables').item.json.generation_id }}
Position: [1120, -700]
```

### Node 6: Leonardo - Image to Image (HTTP Request)
```
Name: Leonardo - Image to Image
Method: POST
URL: https://cloud.leonardo.ai/api/rest/v1/generations
Authentication: HTTP Header Auth (Leonardo AI API Key)
Headers:
  - Content-Type: application/json
Body (JSON):
{
  "prompt": "{{ $json.enhanced_prompt }}",
  "modelId": "6b645e3a-d64f-4341-a6d8-7a3690fbf042",
  "width": 1024,
  "height": 1024,
  "num_images": 1,
  "sd_version": "PHOENIX",
  "alchemy": true,
  "presetStyle": "CINEMATIC",
  "imagePrompts": [{
    "imageUrl": "{{ $json.source_image_url }}",
    "weight": 0.7
  }]
}
Position: [1344, -700]
```

### Node 7: Wait Generator (Wait node)
```
Name: Wait Generator
Duration: 25 seconds
Position: [1568, -700]
```

### Node 8: Set Leo ID (Set node)
```
Name: Set Leo ID
Assignments:
  - leo_gen_id = {{ $('Leonardo - Image to Image').item.json.sdGenerationJob.generationId }}
  - generation_id = {{ $('Set Generator Variables').item.json.generation_id }}
Position: [1792, -700]
```

### Node 9: Get Generated Image (HTTP Request)
```
Name: Get Generated Image
Method: GET
URL: https://cloud.leonardo.ai/api/rest/v1/generations/{{ $json.leo_gen_id }}
Authentication: HTTP Header Auth (Leonardo AI API Key)
Position: [2016, -700]
```

### Node 10: Set Final (Set node)
```
Name: Set Final
Assignments:
  - generated_image_url = {{ $json.generations_by_pk.generated_images[0].url }}
  - generation_id = {{ $('Set Generator Variables').item.json.generation_id }}
Position: [2240, -700]
```

### Node 11: Update Supabase (Supabase node)
```
Name: Update Supabase
Operation: UPDATE
Table: dream_generations
Filter: id = eq.{{ $json.generation_id }}
Fields:
  - generated_image_url = {{ $json.generated_image_url }}
  - status = completed
Position: [2464, -700]
```

### Node 4B (FALSE branch): Not Premium (Supabase node)
```
Name: Not Premium
Operation: UPDATE
Table: dream_generations
Filter: id = eq.{{ $('Set Generator Variables').item.json.generation_id }}
Fields:
  - status = failed
  - error_message = Premium required
Position: [896, -480]
```

## 4. NODE BAÄžLANTILARI (CONNECTIONS)

```
Generator Webhook â†’ Set Generator Variables
Set Generator Variables â†’ Check Premium (Generator)
Check Premium (Generator) â†’ Is Premium?

Is Premium? (TRUE) â†’ Enhance Prompt
Enhance Prompt â†’ Set Enhanced
Set Enhanced â†’ Leonardo - Image to Image
Leonardo - Image to Image â†’ Wait Generator
Wait Generator â†’ Set Leo ID
Set Leo ID â†’ Get Generated Image
Get Generated Image â†’ Set Final
Set Final â†’ Update Supabase

Is Premium? (FALSE) â†’ Not Premium
```

## 5. KAYDET VE TEST ET

Workflow'u kaydet ve test et!

---

## ðŸ“‹ Ã–ZET
- **Toplam yeni node:** 12
- **Yeni webhook:** generator-webhook
- **Leonardo AI:** Image-to-Image kullanÄ±mÄ±
- **Premium check:** Sadece premium kullanÄ±cÄ±lar
